#!/usr/bin/env node

const program = require('commander');
const path = require('path');
const readMeta = require('read-metadata');
const createdb = require('../lib/createdb').createdb;
const addApi = require('../lib/addApi').addApi;
const createPage = require('../lib/createPage').createPage;

program
    .usage('<plugin-name> <page-name> <config-path>')
    .parse(process.argv);

const pluginName = program.args[0];
const pageName = program.args[1];
const configPath = program.args[2];

const config = readMeta.sync(getTemplatePath(configPath));

console.log(createdb(config));
addApi(pageName, pluginName, config);
console.log(JSON.stringify(createPage(pageName, config)));


function getTemplatePath (templatePath) {
    return path.isAbsolute(templatePath)
    ? templatePath
    : path.normalize(path.join(process.cwd(), templatePath));
}


